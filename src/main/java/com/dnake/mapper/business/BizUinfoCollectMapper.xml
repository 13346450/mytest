<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dnake.mapper.business.BizUinfoCollectMapper">
	<resultMap type="BizUinfoCollect" id="bizUinfoCollectMap">
		<id column="id_key" property="idKey" />
		<result column="publish_dt" property="publishDt" />
		<result column="user_content" property="userContent" />
		<result column="user_id" property="userId" />
		<result column="parent_id" property="parentId" />
		<result column="reply_status" property="replyStatus" />
		<result column="content_type" property="contentType" />
		<result column="userinfo_type" property="userinfoType" />
		<result column="community_id" property="communityId" />
		<result column="user_name" property="userName" />
		<result column="title" property="title" />
		<result column="tel" property="tel" />
		<result column="community_code" property="communityCode" />
		<result column="base64_images" property="base64Images" />
		<result column="info_type" property="type" />
		<result column="flag" property="flag" />
		<result column="remark" property="remark" />
		<result column="address" property="address" />
		<result column="email" property="email" />
		<result column="qq" property="qq" />
		<result column="link_man" property="linkMan" />
		<result column="status" property="status" />
		<result column="last_updated" property="lastUpdated" />
		<result column="lh_id" property="lhID" />
	</resultMap>

	<resultMap type="BizUinfoCollectVO" id="bizUinfoCollectMapList">
		<id column="id_key" property="idKey" />
		<result column="publish_dt" property="publishDt" />
		<result column="user_content" property="userContent" />
		<result column="user_id" property="userId" />
		<result column="parent_id" property="parentId" />
		<result column="reply_status" property="replyStatus" />
		<result column="content_type" property="contentType" />
		<result column="userinfo_type" property="userinfoType" />
		<result column="community_id" property="communityId" />
		
		<result column="user_building" property="userBuilding" />
		<result column="user_unit" property="userUnit" />
		<result column="user_floor" property="userFloor" />
		<result column="user_room" property="userRoom" />

		<result column="user_name" property="userName" />
		<result column="title" property="title" />
		<result column="tel" property="tel" />
		<result column="community_code" property="communityCode" />
		<result column="base64_images" property="base64Images" />
		<result column="info_type" property="type" />
		<result column="flag" property="flag" />
		<result column="remark" property="remark" />
		<result column="address" property="address" />
		<result column="email" property="email" />
		<result column="qq" property="qq" />
		<result column="link_man" property="linkMan" />
		<result column="status" property="status" />
		<result column="last_updated" property="lastUpdated" />
		<result column="lh_id" property="lhID" />

		<result column="info_type_name" property="infoTypeName" />
		<result column="community_name" property="communityName" />
		<result column="reply_content" property="replyContent" />
		<result column="reply_dt" property="replyDt" />
		<result column="status_name" property="statusName" />
	</resultMap>
	<insert id="insert" parameterType="BizUinfoCollect"
		useGeneratedKeys="true" keyProperty="idKey">
		insert into biz_uinfo_collect(
		id_key,user_content,publish_dt,user_id, parent_id,reply_status,
		content_type,
		user_name,userinfo_type,community_id,title,tel,community_code,base64_images,info_type,flag,remark,address,email,qq,link_man,status,last_updated,
		lh_id)
		values(
		#{idKey},#{userContent},#{publishDt},#{userId},
		#{parentId},#{replyStatus}, #{contentType},
		#{userName},#{userinfoType},#{communityId},#{title},#{tel},#{communityCode},#{base64Images},#{type},#{flag},#{remark},#{address},#{email},#{qq},#{linkMan},#{status},#{lastUpdated},
		#{lhID})
	</insert>
	<!-- 删除 -->
	<delete id="delete" parameterType="java.lang.Long">
		delete from biz_uinfo_collect
		where id_key = #{idKey}
	</delete>
	<!-- 插入 -->
	<insert id="insertMobile" parameterType="BizUinfoCollect"
		useGeneratedKeys="true" keyProperty="idKey">
		insert into biz_uinfo_collect
		(id_key, publish_dt, user_content, user_id,
		userinfo_type, community_id)
		values
		(#{idKey}, #{publishDt},
		#{userContent}, #{userId}, #{userinfoType}, #{communityId})
	</insert>
	<!-- 分页查询 -->
	<select id="queryPage" resultMap="bizUinfoCollectMapList"
		parameterType="Page">
		select a.*, b.building as user_building, b.unit as user_unit, b.floor as user_floor, b.room as user_room, 
		if(a.reply_status=1 , "未处理",if(a.reply_status=2,"已处理","未知")) as status_name, b.cd_nm as user_name, c.cu_name as community_name, d.user_content as reply_content, d.publish_dt as reply_dt
		from biz_uinfo_collect a
		LEFT JOIN sys_user b on a.user_id = b.id_key
		LEFT JOIN sys_community c on a.community_id = c.id_key
		LEFT JOIN biz_uinfo_collect d on a.id_key = d.parent_id and d.content_type = 2 
		<where>
			a.publish_dt between #{params.startDatetime} and
			#{params.endDatetime}
			<if test='params.communityId != -1 and params.communityId !=null'>
				and a.community_id = #{params.communityId}
			</if>
			<if test=' params.communityIds !=null'>
				and a.community_id in <foreach item="item" index="index"  collection="params.communityIds"    open="(" separator="," close=")"> #{params.communityIds[${index}]}</foreach>   
			</if>
		</where>
		order by a.publish_dt desc
	</select>
	<!-- 手机端查询 -->
	<select id="queryListForMobile" parameterType="Page"
		resultMap="bizUinfoCollectMapList">
		select a.*, b.cd_nm as user_name, c.cu_name as community_name
		from biz_uinfo_collect a
		LEFT JOIN sys_user b on a.user_id = b.id_key
		LEFT JOIN sys_community c on a.community_id = c.id_key
		<where>
			a.community_id = #{params.communityId} and a.user_id = #{params.userId} and
			a.parent_id = -1
		</where>
		order by a.publish_dt desc
	</select>
	<!-- 手机端web查询 -->
	<select id="queryListForWeb" parameterType="java.lang.Long"
		resultMap="bizUinfoCollectMapList">
		select a.*, b.cd_nm as user_name, c.cu_name as community_name
		from biz_uinfo_collect a
		LEFT JOIN sys_user b on a.user_id = b.id_key
		LEFT JOIN sys_community c on a.community_id = c.id_key
		<where>
			a.community_id = #{idKey}
		</where>
		order by a.publish_dt desc
	</select>
	<select id="queryMobileByIdKey" parameterType="java.lang.Long"
		resultMap="bizUinfoCollectMapList">
		select a.*, b.cd_nm as user_name, c.cu_name as community_name, d.user_content as reply_content, d.publish_dt as reply_dt 
		from biz_uinfo_collect a
		LEFT JOIN sys_user b on a.user_id = b.id_key
		LEFT JOIN sys_community c on a.community_id = c.id_key
		LEFT JOIN biz_uinfo_collect d on a.id_key = d.parent_id and d.content_type = 2 
		<where>
			a.id_key = #{idKey}
		</where>
		order by a.publish_dt desc
	</select>
	<!-- 多行删除 -->
	<delete id="deleteMulti" parameterType="java.util.Map">
		delete from biz_uinfo_collect where id_key in
		<foreach item="item" index="index" collection="deviceIdin"
			open="(" separator="," close=")">${item}</foreach>
	</delete>



	<update id="update" parameterType="BizUinfoCollect">
		update biz_uinfo_collect
		<set>
			<if test='userContent!= null and userContent!=""'>
				user_content=#{userContent},
			</if>
			<if test='publishDt!= null and publishDt!=""'>
				publish_dt=#{publishDt},
			</if>
			<if test='userId!= null and userId!=""'>
				user_id=#{userId},
			</if>
			<if test='parentId!= null and parentId!=""'>
				parent_id=#{parentId},
			</if>
			<if test='replyStatus!= null and replyStatus!=""'>
				reply_status=#{replyStatus},
			</if>
			<if test='contentType!= null and contentType!=""'>
				content_type=#{contentType},
			</if>
			<if test='userName!= null and userName!=""'>
				user_name=#{userName},
			</if>
			<if test='userinfoType!= null and userinfoType!=""'>
				userinfo_type=#{userinfoType},
			</if>
			<if test='communityId!= null and communityId!=""'>
				community_id=#{communityId},
			</if>
			<if test='title!= null and title!=""'>
				title=#{title},
			</if>
			<if test='tel!= null and tel!=""'>
				tel=#{tel},
			</if>
			<if test='communityCode!= null and communityCode!=""'>
				community_code=#{communityCode},
			</if>
			<if test='base64Images!= null and base64Images!=""'>
				base64_images=#{base64Images},
			</if>
			<if test='type!= null and type!=""'>
				info_type=#{type},
			</if>
			<if test='flag!= null and flag!=""'>
				flag=#{flag},
			</if>
			<if test='remark!= null and remark!=""'>
				remark=#{remark},
			</if>
			<if test='address!= null and address!=""'>
				address=#{address},
			</if>
			<if test='email!= null and email!=""'>
				email=#{email},
			</if>
			<if test='qq!= null and qq!=""'>
				qq=#{qq},
			</if>
			<if test='linkMan!= null and linkMan!=""'>
				link_man=#{linkMan},
			</if>
			<if test='status!= null and status!=""'>
				status=#{status},
			</if>
			<if test='lastUpdated!= null and lastUpdated!=""'>
				last_updated=#{lastUpdated},
			</if>
			<if test='lhID!= null and lhID!=""'>
				lh_id=#{lhID}
			</if>
		</set>
		where id_key= #{idKey}
	</update>

	<select id="queryByIdkey" resultMap="bizUinfoCollectMap"
		parameterType="java.lang.Long">
		select * from biz_uinfo_collect where id_key=#{idKey}
	</select>

	<select id="queryByCommunityCode" resultMap="bizUinfoCollectMapList"
		parameterType="java.lang.String">
		select * from biz_uinfo_collect where
		community_code=#{communityCode}
	</select>

	<select id="queryUinfoDetailList" resultMap="bizUinfoCollectMapList"
		parameterType="java.lang.Long">
		select a.*, b.cd_nm as user_name, c.cu_name as community_name, d.user_content as reply_content, d.publish_dt as reply_dt 
		from biz_uinfo_collect a
		LEFT JOIN sys_user b on a.user_id = b.id_key
		LEFT JOIN sys_community c on a.community_id = c.id_key
		LEFT JOIN biz_uinfo_collect d on a.id_key = d.parent_id and d.content_type = 2
		where a.parent_id =
		#{parentId} and a.content_type = 1
	</select>

	<select id="queryMobileByParentId" resultMap="bizUinfoCollectMapList"
		parameterType="java.lang.Long">
		select * from biz_uinfo_collect where parent_id =
		#{parentId} and content_type = 2
	</select>

	<select id="queryNoReplyListByParentId" resultMap="bizUinfoCollectMapList"
		parameterType="java.lang.Long">
		select * from biz_uinfo_collect where parent_id =
		#{parentId} and content_type = 1 and reply_status = 1
	</select>
</mapper>