<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dnake.mapper.business.BizUserGiftMapper">
	<resultMap type="BizUserGift" id="bizUserGiftMap">
		<id column="id_key" property="idKey" />
		<result column="user_id" property="userId" />
		<result column="shop_id" property="shopId" />
		<result column="gift_id" property="giftId" />
		<result column="status" property="status" />
		<result column="promotion_id" property="promotionId" />
		<result column="start_dt" property="startDt" />
		<result column="end_dt" property="endDt" />
		<result column="chg_dt" property="chgDt" />
		<result column="type" property="type" />
		<result column="value" property="value" />
		<result column="goods_id" property="goodsId" />
		<result column="coupon_category" property="couponCategory" />
		<result column="coupon_min_money" property="couponMinMoney" />
		<result column="one_max_use" property="oneMaxUse" />
		<result column="use_with_others" property="useWithOthers" />
		<result column="remarks" property="remarks" />
	</resultMap>

	<resultMap type="BizUserGiftVO" id="bizUserGiftList">
		<id column="id_key" property="idKey" />
		<result column="user_id" property="userId" />
		<result column="shop_id" property="shopId" />
		<result column="gift_id" property="giftId" />
		<result column="status" property="status" />
		<result column="promotion_id" property="promotionId" />
		<result column="start_dt" property="startDt" />
		<result column="end_dt" property="endDt" />
		<result column="chg_dt" property="chgDt" />
		<result column="type" property="type" />
		<result column="value" property="value" />
		<result column="goods_id" property="goodsId" />
		<result column="coupon_category" property="couponCategory" />
		<result column="coupon_min_money" property="couponMinMoney" />
		<result column="one_max_use" property="oneMaxUse" />
		<result column="use_with_others" property="useWithOthers" />
		<result column="remarks" property="remarks" />
		<result column="shop_name" property="shopName" />
		<result column="category_name" property="categoryName" />

	</resultMap>

	<insert id="insert" parameterType="BizUserGift"
		useGeneratedKeys="true" keyProperty="idKey">
		insert into biz_user_gift(
		id_key,user_id,shop_id,gift_id,status,promotion_id,start_dt,end_dt,chg_dt,type,value,goods_id,coupon_category,coupon_min_money,one_max_use,use_with_others,remarks)
		values(
		#{idKey},#{userId},#{shopId},#{giftId},#{status},#{promotionId},#{startDt},#{endDt},#{chgDt},#{type},#{value},#{goodsId},#{couponCategory},#{couponMinMoney},#{oneMaxUse},#{useWithOthers},#{remarks})
	</insert>

	<delete id="delete" parameterType="java.lang.Long">
		delete from biz_user_gift where id_key=#{idKey}
	</delete>

	<update id="update" parameterType="BizUserGift">
		update biz_user_gift
		<set>
			<if test='userId!= null and userId!=""'>
				user_id=#{userId},
			</if>
			<if test='shopId!= null and shopId!=""'>
				shop_id=#{shopId},
			</if>
			<if test='giftId!= null and giftId!=""'>
				gift_id=#{giftId},
			</if>
			<if test='status!= null and status!=""'>
				status=#{status},
			</if>
			<if test='promotionId!= null and promotionId!=""'>
				promotion_id=#{promotionId},
			</if>
			<if test='startDt!= null and startDt!=""'>
				start_dt=#{startDt},
			</if>
			<if test='endDt!= null and endDt!=""'>
				end_dt=#{endDt},
			</if>
			<if test='chgDt!= null and chgDt!=""'>
				chg_dt=#{chgDt},
			</if>
			<if test='type!= null and type!=""'>
				type=#{type},
			</if>
			<if test='value!= null and value!=""'>
				value=#{value},
			</if>
			<if test='goodsId!= null and goodsId!=""'>
				goods_id=#{goodsId},
			</if>
			<if test='couponCategory!= null and couponCategory!=""'>
				coupon_category=#{couponCategory},
			</if>
			<if test='couponMinMoney!= null and couponMinMoney!=""'>
				coupon_min_money=#{couponMinMoney},
			</if>
			<if test='oneMaxUse!= null and oneMaxUse!=""'>
				one_max_use=#{oneMaxUse},
			</if>
			<if test='useWithOthers!= null and useWithOthers!=""'>
				use_with_others=#{useWithOthers},
			</if>
			<if test='remarks!= null and remarks!=""'>
				remarks=#{remarks},
			</if>
		</set>
		where id_key= #{idKey}
	</update>

	<select id="queryByIdkey" resultMap="bizUserGiftMap"
		parameterType="java.lang.Long">
		select * from biz_user_gift where id_key=#{idKey}
	</select>

	<select id="queryPage" resultMap="bizUserGiftList"
		parameterType="Page">
		select a.*,b.name as shop_name,c.category_name,d.name from biz_user_gift a
		left join
		biz_shop b on a.shop_id=b.id_key left join biz_category c on
		c.id_key=a.coupon_category left join  biz_promotion d on d.id_key=a.promotion_id
		<where> <!-- chg_dt between #{params.startDatetime} and #{params.endDatetime} -->
			<if test='params.userId != null and params.userId != ""'>
				and a.user_id=#{params.userId}
			</if>
			<if test='params.shopId != null and params.shopId != ""'>
				and a.shop_id=#{params.shopId}
			</if>
			<if test='params.promotion_id != null and params.promotion_id != ""'>
				and a.promotion_id=#{params.promotion_id}
			</if>
			<if test='params.nowTime != null and params.nowTime != ""'>
				and a.end_dt>#{params.nowTime}
			</if>
		</where>
	</select>

	<delete id="deleteMulti" parameterType="java.util.Map">
		delete from biz_user_gift where id_key in
		<foreach item="item" index="index" collection="deviceIdin"
			open="(" separator="," close=")">${item}</foreach>
	</delete>

	<insert id="insertMulti" parameterType="java.util.List">
		insert into biz_user_gift(
		user_id,shop_id,gift_id,status,promotion_id,start_dt,end_dt,chg_dt,type,value,goods_id,coupon_category,coupon_min_money,one_max_use,use_with_others,remarks)
		values
		<foreach collection="list" item="item" separator="," index="index">
			(#{item.userId},#{item.shopId},#{item.giftId},#{item.status},#{item.promotionId},#{item.startDt},#{item.endDt},#{item.chgDt},#{item.type},#{item.value},#{item.goodsId},#{item.couponCategory},#{item.couponMinMoney},#{item.oneMaxUse},#{item.useWithOthers},#{item.remarks})
		</foreach>
	</insert>
	
</mapper>
