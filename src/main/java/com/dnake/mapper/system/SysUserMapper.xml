<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dnake.mapper.system.SysUserMapper">
	<resultMap type="SysUser" id="sysUserMap">
		<id column="ID_KEY" property="idKey" />
		<result column="user_cd" property="userCd" jdbcType="VARCHAR" />
		<result column="cd_nm" property="cdNm" jdbcType="VARCHAR" />
		<result column="order_cd" property="orderCd" jdbcType="DECIMAL" />
		<result column="use_mark" property="useMark" jdbcType="DECIMAL" />
		<result column="gender" property="gender" jdbcType="VARCHAR" />
		<result column="user_pwd" property="userPwd" jdbcType="VARCHAR" />
		<result column="dept_id" property="deptId" jdbcType="DECIMAL" />
		<result column="building" property="building" jdbcType="VARCHAR" />
		<result column="unit" property="unit" jdbcType="VARCHAR" />
		<result column="floor" property="floor" jdbcType="VARCHAR" />
		<result column="room" property="room" jdbcType="VARCHAR" />
		<result column="telephone" property="telephone" jdbcType="VARCHAR" />
		<result column="role_id" property="roleId" jdbcType="DECIMAL" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="direct_dept" property="directDept" jdbcType="DECIMAL" />
		<result column="user_status" property="userStatus" jdbcType="DECIMAL" />
		<result column="login_nm" property="loginNm" jdbcType="VARCHAR" />
		<result column="chg_dt" property="chgDt" jdbcType="DATE" />
		<result column="IS_MODIFY" property="isModify" />
		<result column="bind_tel" property="bindTel" />
		<result column="region_id" property="regionId" />
		<result column="house_type" property="houseType" jdbcType="CHAR" />
		
	</resultMap>

	<resultMap type="SysUser" id="sysUserList">
		<id column="ID_KEY" property="idKey" />
		<result column="user_cd" property="userCd" jdbcType="VARCHAR" />
		<result column="cd_nm" property="cdNm" jdbcType="VARCHAR" />
		<result column="order_cd" property="orderCd" jdbcType="DECIMAL" />
		<result column="use_mark" property="useMark" jdbcType="DECIMAL" />
		<result column="gender" property="gender" jdbcType="VARCHAR" />
		<result column="user_pwd" property="userPwd" jdbcType="VARCHAR" />
		<result column="dept_id" property="deptId" jdbcType="DECIMAL" />
		<result column="building" property="building" jdbcType="VARCHAR" />
		<result column="unit" property="unit" jdbcType="VARCHAR" />
		<result column="floor" property="floor" jdbcType="VARCHAR" />
		<result column="room" property="room" jdbcType="VARCHAR" />
		<result column="telephone" property="telephone" jdbcType="VARCHAR" />
		<result column="role_id" property="roleId" jdbcType="DECIMAL" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="direct_dept" property="directDept" jdbcType="DECIMAL" />
		<result column="user_status" property="userStatus" jdbcType="DECIMAL" />
		<result column="login_nm" property="loginNm" jdbcType="VARCHAR" />
		<result column="chg_dt" property="chgDt" jdbcType="DATE" />
		<result column="IS_MODIFY" property="isModify" />
		<result column="bind_tel" property="bindTel" />
		<result column="region_id" property="regionId" />
		<result column="house_type" property="houseType" jdbcType="CHAR" />

		<result column="role_name" property="roleName" jdbcType="VARCHAR" />
		<result column="role_type" property="roleType" />
		<result column="dept_name" property="deptName" jdbcType="VARCHAR" />
	</resultMap>

	<select id="queryAll" resultMap="sysUserList">
		select
		t.*,sys_role.role_name,sys_community.cu_name dept_name
		from sys_user t
		left join sys_role on sys_role.id_key = t.role_id
		left join sys_community on sys_community.id_key = t.dept_id
		order by
		t.user_cd asc
	</select>

	<select id="queryPage" resultMap="sysUserList" parameterType="Page">
		select a.*,b.role_name,b.role_type from sys_user a,sys_role b
		where a.role_id=b.id_key
		and a.dept_id=#{params.deptID}
		order by a.order_cd
	</select>

	<select id="queryByLoginNm" parameterType="java.lang.String"
		resultMap="sysUserList">
		select t.*,c.cd_nm as dept_name,r.role_name from sys_user t,sys_role r,sys_dept c
			where t.login_nm = #{loginNm}  
			and t.role_id=r.id_key
			and t.dept_id=c.id_key
	</select>
	
	<select id="mobileQueryByLoginNm" parameterType="java.lang.String"
		resultMap="sysUserList">
		select t.*,r.role_name,c.cu_name dept_name from sys_user t,sys_role r,sys_community c  where t.login_nm = #{loginNm} and t.dept_id=c.id_key and t.role_id=r.id_key
	</select>
	<select id="queryById" parameterType="java.lang.Long" resultMap="sysUserMap">
		select * from sys_user t where t.id_key = #{userId}
	</select>
	<select id="queryByBindTel" parameterType="SysUser" resultMap="sysUserMap">
		select * from sys_user t where t.bind_tel = #{bindTel}
	</select>
	<insert id="insert" parameterType="SysUser" useGeneratedKeys="true"
		keyProperty="idKey">
		insert into sys_user (id_key, user_cd, cd_nm,order_cd,
		use_mark, gender, user_pwd,dept_id,building,unit,floor,
		room,telephone,addr,
		role_id, remark, user_status, login_nm, chg_dt, bind_tel)
		values (#{idKey}, #{userCd}, #{cdNm}, #{orderCd}, #{useMark},
		#{gender},#{userPwd}, #{deptId},
		#{building},#{unit},#{floor},#{room},#{telephone},#{addr},#{roleId},
		#{remark},
		#{userStatus}, #{loginNm}, #{chgDt}, #{bindTel})
	</insert>
	<delete id="delete" parameterType="java.lang.Long">
		delete a.*,b.* from sys_user a left join sys_user_popedom b on a.id_key=b.user_id where	a.id_key = #{userId}
	</delete>

	<update id="update" parameterType="SysUser">
		update sys_user
		<set>
			<if test='cdNm != null'>
				cd_nm = #{cdNm},
			</if>
			<if test='userCd != null'>
				user_cd = #{userCd},
			</if>
			<if test='orderCd != null'>
				order_cd = #{orderCd},
			</if>
			<if test='useMark != null'>
				use_mark = #{useMark},
			</if>
			<if test='roleId != null'>
				role_id = #{roleId},
			</if>
			<if test='loginNm != null'>
				login_nm = #{loginNm},
			</if>
			<if test='chgDt != null'>
				chg_dt = #{chgDt},
			</if>
			<if test='building != null'>
				building = #{building},
			</if>
			<if test='remark != null'>
				remark = #{remark},
			</if>
			<if test='unit != null'>
				unit = #{unit},
			</if>
			<if test='telephone != null'>
				telephone = #{telephone},
			</if>
			<if test='addr != null'>
				addr = #{addr},
			</if>
			<if test='floor != null'>
				floor = #{floor},
			</if>
			<if test='room != null'>
				room = #{room},
			</if>
			<if test="userPwd">
				user_pwd=#{userPwd},
			</if>
			<if test="deptId">
				dept_id=#{deptId},
			</if>
			<if test="bindTel != null">
				bind_tel = #{bindTel},
			</if>
		</set>
		where id_key = #{idKey}
	</update>
	<update id="modifyPwd" parameterType="SysUser">
		update sys_user
		set user_pwd = #{userPwd},is_modify = #{isModify}
		where id_key = #{idKey}
	</update>
	<select id="queryBydeptID" parameterType="java.lang.Long"
		resultMap="sysUserMap">
		select * from sys_user t where t.dept_id = #{deptId}
	</select>
	<select id="isHaveUser" parameterType="java.lang.Long"
		resultMap="sysUserMap">
		select * from sys_user t where t.dept_id = #{deptId}
	</select>
	<update id="updateDeptIDByIdKey" parameterType="java.util.Map">
		update sys_user
		SET dept_id = #{deptID} WHERE id_key = #{idKey}
	</update>
	<select id="edit" parameterType="java.lang.Long" resultMap="sysUserMap">
		select * from sys_user t where t.id_key = #{idKey}
	</select>
	<select id="qByLoginNm" parameterType="java.lang.String"
		resultMap="sysUserMap">
		select id_key, login_nm, role_id from sys_user t where t.login_nm = #{loginNm}
	</select>
	<select id="queryByUserCd" parameterType="java.lang.String"
		resultMap="sysUserMap">
		select user_cd from sys_user t where t.user_cd = #{userCd}
	</select>
	<select id="queryByUserCdUp" parameterType="SysUser" resultMap="sysUserMap">
		select user_cd from sys_user t where t.user_cd = #{userCd} and
		t.id_key!=#{idKey}
	</select>
	<select id="queryByLoginNmUp" parameterType="SysUser" resultMap="sysUserMap">
		select login_nm from sys_user t where t.login_nm = #{loginNm} and
		t.id_key!=#{idKey}
	</select>
	<!-- xzmAdd201331 查询同级中排序码最大值加10 -->
	<select id="queryMaxOrderCdByPId" parameterType="java.lang.Long"
		resultType="java.lang.Long">
		select max(order_cd)+10 from sys_user a where a.dept_id =
		#{deptId}
	</select>

	<select id="queryList" resultMap="sysUserList" parameterType="java.lang.Long">
		select a.*,b.role_name,b.role_type from sys_user a,sys_role b where
		a.role_id=b.id_key and a.id_key = #{userId}
	</select>
	<select id="queryBycdNm" parameterType="java.lang.String"
		resultMap="sysUserMap">
		select * from sys_user t where t.cd_nm = #{cdNm}
	</select>
	
	<select id="queryByShopId" parameterType="java.lang.String"
		resultMap="sysUserMap">
		select a.* from sys_user a,biz_shop b  where b.user_id = a.id_key and b.id_key=#{shopId}
	</select>
	
	<select id="queryByLoginName2Community" parameterType="java.lang.String"
		resultMap="sysUserList">
		select t.*,c.cu_name as dept_name, c.dept_id as region_id ,r.role_name from sys_user t, sys_role r, sys_community c
			where t.login_nm = #{loginNm}
			and t.role_id=r.id_key
			and t.dept_id=c.id_key
	</select>
	<select id="listByRoleId" parameterType="int" resultMap="sysUserMap">
		select * from sys_user t where t.role_id = #{roleId}
	</select>
</mapper>